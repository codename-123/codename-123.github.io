---
title: "Guardian (Hard)"
date: 2025-11-12
layout: single
excerpt: "Guardian은 Hard 난이도의 Linux 머신으로, 학생 포털의 기본 비밀번호 GU1234와 IDOR 취약점을 이용해 다른 사용자의 데이터를 열람하고, 이를 통해 숨겨진 Gitea 서브도메인과 자격 증명을 확보하는 것이 초기 진입점이다. Gitea에 공개된 소스코드에서 취약한 PhpSpreadsheet 버전을 확인한 뒤, XLSX 기반 XSS 취약점을 과제 제출 기능에 악용해 Lecturer → Admin 권한까지 상승하고, DB 설정과 salt가 포함된 해시 로직을 파악해 sha256(password + salt) 형식의 패스워드를 크랙함으로써 시스템 사용자 계정으로 이동한다.이후 sudo로 실행 가능한 Python 스크립트가 취약한 모듈을 import하는 점을 이용해 모듈 하이재킹으로 다음 사용자(mark)까지 권한을 확장한다. 마지막으로 mark 계정의 커스텀 바이너리 safeapache2ctl을 Ghidra 등으로 리버싱해 보면, /home/mark/confs/ 아래 Apache 설정만 허용하는 것처럼 보이지만 LoadModule/Include에 대해 상대경로 검증이 부실하다는 점이 드러나며, 이를 악용해 공격자가 작성한 악성 모듈을 root 권한 Apache가 로드하게 만들어 최종적으로 루트 권한을 탈취할 수 있다."
author_profile: true
toc: true
toc_label: "Guardian"
toc_icon: "book"
toc_sticky: true
header:
  teaser: /assets/htb-linux/guardian/guardian.png
  teaser_home_page: true
categories: [hackthebox linux]
tags: [htb, linux, docker, web, command-injection, rce, ssti, reverse-shell, priv-esc, mongodb, rocket.chat, twig, bolt-cms, chisel, capabilities, shadow, webhook]
---

![Talkative](/assets/htb-linux/guardian/guardian.png)

**Guardian**은 Hard 난이도의 Linux 머신으로, 초기 진입점은 학생 포털의 기본 비밀번호인 `GU1234`와 `IDOR` 취약점을 이용해 다른 사용자의 데이터를 열람하고, 이를 통해 숨겨진 `Gitea` 서브도메인과 자격 증명을 확보하는 것이다. Gitea에 공개된 소스코드에서 취약한 `PhpSpreadsheet` 버전을 확인한 뒤, **XLSX 기반 XSS 취약점**을 과제 제출 기능에 악용하여 _Lecturer → Admin_ 권한까지 상승하고, 데이터베이스 설정과 `salt`가 포함된 해시 로직을 분석해 `sha256(password + salt)` 형식의 패스워드를 크랙함으로써 시스템 사용자 계정으로 이동한다.

이후 `sudo`로 실행 가능한 Python 스크립트가 쓰기 가능한 모듈을 `import`하는 점을 이용해 **모듈 하이재킹** 으로 다음 사용자(`mark`)까지 권한을 확장한다. 마지막 단계에서는 `mark` 계정의 커스텀 바이너리인 `safeapache2ctl`을 Ghidra 등으로 리버싱하여, 설정 파일을 `/home/mark/confs/`로 제한하는 것처럼 보이지만 `LoadModule` 및 `Include` 디렉티브의 **상대경로에 대한 검증이 부실**하다는 점을 찾아낸다. 이를 악용해 공격자가 작성한 악성 모듈과 특수한 Apache 설정을 조합하면, `safeapache2ctl -f` 실행 시 **root 권한의 Apache**가 해당 모듈을 로드하게 되고, 최종적으로 루트 권한을 탈취할 수 있다.
