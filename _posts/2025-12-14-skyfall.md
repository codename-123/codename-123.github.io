---
title: "Skyfall (Insane)"
date: 2025-12-14
layout: single
excerpt: "Skyfall은 Insane 난이도의 머신으로 MinIO를 백엔드로 사용하는 Flask 기반 베타 클라우드 스토리지 웹 애플리케이션이 구성되어 있다. Nginx ACL과 Flask 설정 오류로 인해 제한 구역 접근이 가능하며, 해당 구역에 노출된 MinIO Prometheus 메트릭을 통해 내부 호스트명과 취약한 MinIO 버전을 확인할 수 있다. 노출된 MinIO 버전에는 CVE-2023-28432 정보 노출 취약점이 존재하며, 이를 통해 MinIO 루트 자격 증명이 유출된다. 해당 자격 증명으로 S3 버킷에 접근하면 사용자 홈 디렉터리 백업과 버전 기록이 저장되어 있고, 그중 한 버전에 Hashicorp Vault 토큰이 포함되어 있다. 이 토큰으로 Vault 정책을 열거하면 SSH OTP 인증이 설정되어 있음을 확인할 수 있으며, Vault에서 OTP를 요청해 일반 사용자로 SSH 접속이 가능하다. 이후 해당 사용자는 Vault 언실 바이너리를 sudo로 실행할 수 있고, 특정 플래그 사용 시 루트 소유의 debug.log 파일이 생성된다. sshfs 기반 FUSE 마운트를 이용해 권한 제한을 우회하여 해당 파일을 유출하면 로그에서 Vault 루트 토큰을 획득할 수 있으며, 이 토큰으로 루트 OTP를 생성해 최종적으로 루트 권한으로 SSH 로그인이 가능하다."
author_profile: true
toc: true
toc_label: "Previous"
toc_icon: "book"
toc_sticky: true
header:
  teaser: /assets/htb-linux/skyfall/skyfall.png
  teaser_home_page: true
categories: [hackthebox-linux]
tags: [htb, linux, web, nextjs, middleware-bypass, cve-2025-29927, lfi, file-disclosure, credentials-leak, ssh, terraform, dev-overrides, sudo, priv-esc, suid, local-exploit]
---

![Puppy](/assets/htb-linux/skyfall/skyfall.png)

# Skyfall Write-up Summary

**Skyfall**은 Insane 난이도의 머신으로 MinIO를 백엔드로 사용하는 `Flask` 기반 베타 클라우드 스토리지 웹 애플리케이션이 구성되어 있다.  
**Nginx ACL과 Flask 설정 오류로 인해 인증 우회**가 가능하며, 해당 구역에 노출된 MinIO Prometheus 메트릭을 통해 내부 호스트명과 취약한 MinIO 버전을 확인할 수 있다.

**노출된 MinIO 버전에는 `CVE-2023-28432` 정보 노출 취약점이 존재하며**, 이를 통해 MinIO 루트 자격 증명이 유출된다.  
해당 자격 증명으로 S3 버킷에 접근하면 사용자 홈 디렉터리 백업과 버전 기록이 저장되어 있고, 그중 한 버전에 **Hashicorp Vault 토큰이 포함**되어 있다.

이 토큰을 활용해 Vault를 열거하면 `SSH OTP` 인증이 설정되어 있음을 확인할 수 있으며, Vault에서 OTP를 요청해 일반 사용자로 SSH 접속이 가능하다.  
이후, 해당 사용자는 Vault 언실 바이너리를 `sudo`로 실행할 수 있고, 특정 플래그 사용 시 루트 소유의 `debug.log` 파일이 생성된다.

**`sshfs` 기반 FUSE 마운트를 이용해 파일을 유출하면**, 로그에서 Vault 루트 토큰을 획득할 수 있으며, **해당 토큰으로 루트 OTP를 생성해** 최종적으로 루트 권한으로 SSH 로그인이 가능하다.

# Enumeration

## Portscan

먼저 대상 Host(`10.129.230.158`)에 대해 기본 스크립트와 서비스 버전 탐지를 수행하였다:

```bash
$ nmap -sC -sV 10.129.230.158 | tee nmap

Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-13 23:39 EST
Nmap scan report for skyfall.htb (10.129.230.158)
Host is up (0.20s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 65:70:f7:12:47:07:3a:88:8e:27:e9:cb:44:5d:10:fb (ECDSA)
|_  256 74:48:33:07:b7:88:9d:32:0e:3b:ec:16:aa:b4:c8:fe (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Skyfall - Introducing Sky Storage!
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.87 seconds
```

Nmap 스캔 결과 `SSH(22)`, `HTTP(80)` 서비스가 열려 있으며, 웹 페이지 접근 시 **skyfall.htb** 도메인으로 접근해야 함을 확인했다.

---

# Vulnerability Analysis

웹 페이지에 접속하게 되면 뭘한다

![Puppy](/assets/htb-linux/skyfall/web.png){: .image-popup }



