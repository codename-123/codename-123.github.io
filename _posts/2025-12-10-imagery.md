---
title: "Imagery (Medium)"
date: 2025-12-09
layout: single
excerpt: "OnlyForYou는 중간 난이도 머신으로, 웹 애플리케이션에 존재하는 LFI(Local File Inclusion) 취약점을 통해 소스 코드를 열람할 수 있고, 이 코드에서 발견된 Blind Command Injection을 이용해 셸을 획득할 수 있다. 이후 머신 내부에서 실행 중인 여러 로컬 서비스 중 하나가 기본 자격 증명을 사용하고 있으며, 이 서비스의 특정 엔드포인트는 Cypher 인젝션에 취약하여 Neo4j 데이터베이스의 해시를 유출할 수 있고, 이 해시를 통해 SSH 접근 권한을 얻는다. 마지막으로, sudoers 파일이 잘못 구성되어 있어 pip3 download 명령을 루트 권한으로 실행할 수 있으며, 이를 이용해 Gogs에 호스팅된 악성 파이썬 패키지를 다운로드하고 실행함으로써 루트 권한을 탈취할 수 있다."
author_profile: true
toc: true
toc_label: "Imagery"
toc_icon: "book"
toc_sticky: true
header:
  teaser: /assets/htb-linux/imagery/imagery.png
  teaser_home_page: true
categories: [hackthebox-linux]
tags: [htb, linux, web, lfi, command-injection, rce, neo4j, priv-esc, cypher-injection, gogs, pip-exploit, sudo, chisel, reverse-shell]
---

![Imagery](/assets/htb-linux/imagery/imagery.png)

# Enumeration

## Portscan

먼저 대상 Host(`10.129.2.56`)에 대해 기본 스크립트와 서비스 버전 탐지를 수행하였다:

```bash
$ nmap -sC -sV 10.129.2.56 | tee nmap
Starting Nmap 7.95 ( https://nmap.org ) at 2025-12-09 12:25 EST
Nmap scan report for 10.129.2.56
Host is up (0.20s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.7p1 Ubuntu 7ubuntu4.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 35:94:fb:70:36:1a:26:3c:a8:3c:5a:5a:e4:fb:8c:18 (ECDSA)
|_  256 c2:52:7c:42:61:ce:97:9d:12:d5:01:1c:ba:68:0f:fa (ED25519)
8000/tcp open  http    Werkzeug httpd 3.1.3 (Python 3.12.7)
|_http-server-header: Werkzeug/3.1.3 Python/3.12.7
|_http-title: Image Gallery
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.96 seconds
```

Nmap 스캔 결과, `SSH(22)`/`HTTP(8000)` 서비스가 열려 있다. `HTTP(8000)` 포트에서 접근 가능한 웹 애플리케이션이 존재함을 확인할 수 있다.

# Vulnerability Analysis

## Web Page Access

`8000` 번 포트에서 동작하는 웹 서버에 접속해보면, `Imagery` 라는 이름의 이미지 갤러리 웹 애플리케이션이 나타난다:

![Imagery](/assets/htb-linux/imagery/website.png)

계정을 생성하고 로그인에 성공하면, 아래와 같은 개인 이미지 갤러리 페이지가 나타난다:

![Imagery](/assets/htb-linux/imagery/login-success.png)

## XSS

